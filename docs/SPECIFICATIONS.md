# VarejoFlex - Especifica√ß√µes T√©cnicas por Segmento

## üèóÔ∏è N√∫cleo Comum (Todos os Segmentos)

### **Telas Cliente (Loja do Lojista)**
- **Cat√°logo/Card√°pio**: Listagem de produtos por categoria
- **Detalhe do Produto**: Varia√ß√µes, complementos, imagens
- **Carrinho & Cupons**: Gest√£o de itens e promo√ß√µes
- **Checkout**: Entrega/Retirada, Pagamento (PIX/Cart√£o/Dinheiro)
- **Rastreamento**: Status do pedido em tempo real
- **Autentica√ß√£o**: Login/Cadastro de clientes
- **Conta do Cliente**: Hist√≥rico, dados pessoais, endere√ßos

### **Telas Admin (Lojista)**
- **Produtos**: CRUD completo com varia√ß√µes e imagens
- **Categorias**: Organiza√ß√£o hier√°rquica
- **Estoque**: Controle por produto/varia√ß√£o
- **Pre√ßos/Promo√ß√µes/Cupons**: Gest√£o comercial
- **Entrega**: √Årea/raio/CEP e taxas
- **Hor√°rios/Feriados**: Funcionamento da loja
- **Pedidos**: Gest√£o completa do fluxo
- **Clientes**: Base cadastral e hist√≥rico
- **Integra√ß√µes**: APIs e webhooks
- **Relat√≥rios**: Dashboards e m√©tricas

### **M√≥dulos Base**
- **Cat√°logo/Produtos**: Varia√ß√µes, imagens, tags
- **Pedidos & Pagamentos**: PIX/Cart√£o/Dinheiro
- **Entrega/Retirada**: Tabela de frete, prazos, janelas
- **Cupons/Promo√ß√µes**: Descontos e ofertas
- **Relat√≥rios & Dashboards**: M√©tricas de neg√≥cio
- **KDS**: Kitchen Display System (quando houver produ√ß√£o)
- **Frota**: Gest√£o de entrega pr√≥pria (opcional)

---

## üçî 1. Lanchonetes (MVP - Prioridade 1)

### **Objetivo**
Vender lanches por delivery/retirada com complementos e combos personalizados.

### **Telas Espec√≠ficas - Cliente**
- **Cat√°logo por Categorias**: Lanches, acompanhamentos, bebidas
- **Detalhe com Varia√ß√µes**: Tamanho/ponto do burger, complementos (bacon/queijo)
- **Observa√ß√µes**: Campo livre para customiza√ß√µes
- **Carrinho Inteligente**: Sugest√£o de combos e upsell
- **Agendamento**: Op√ß√£o de pedido para hor√°rio espec√≠fico

### **Telas Espec√≠ficas - Admin**
- **Produto com Complementos**: Configura√ß√£o de adicionais por categoria
- **Upsell/Combos**: Configura√ß√£o de produtos relacionados
- **KDS Cozinha**: Tickets por etapa (prepara√ß√£o ‚Üí finaliza√ß√£o)
- **Tempo de Preparo**: Estimativa din√¢mica baseada na fila

### **Campos Espec√≠ficos**
```typescript
interface LanchoneteProduct {
  varia√ß√µes: {
    size: { label: string; price: number }[]
  }
  complementos: {
    category: string;
    items: { name: string; price: number }[]
  }[]
  tempo_preparo: number; // minutos base
  observa√ß√µes: boolean; // permite observa√ß√µes
  upsell_config: string[]; // IDs de produtos relacionados
}
```

### **Regras de Neg√≥cio**
- Pre√ßo final = base + varia√ß√µes + complementos √ó quantidade
- Tempo estimado din√¢mico baseado na fila do KDS
- Cupons podem ser aplicados por categoria espec√≠fica
- Upsell autom√°tico no carrinho (ex.: batata + refri)

### **M√≥dulos/Subm√≥dulos**
- ‚úÖ Cat√°logo com Complementos
- ‚úÖ Checkout com Upsell
- ‚úÖ Cupons por Categoria
- ‚úÖ KDS Cozinha
- üîÑ Frota (opcional)
- ‚úÖ Relat√≥rios de Performance

### **M√©tricas Principais**
- **Ticket M√©dio**: Valor m√©dio por pedido
- **Tempo de Preparo**: M√©dia por produto/categoria
- **Taxa de Convers√£o**: Visitantes ‚Üí Pedidos
- **% Uso de Cupons**: Efetividade promocional
- **Upsell Rate**: % de adicionais vendidos

---

## üçï 2. Pizzarias (Prioridade 2)

### **Objetivo**
Montar pizzas com tamanhos e m√∫ltiplos sabores (¬Ω, ‚Öì, ¬º), borda recheada e adicionais.

### **Telas Espec√≠ficas - Cliente**
- **Seletor de Tamanho**: P/M/G/XL com pre√ßos diferenciados
- **Composi√ß√£o de Sabores**: Interface para meia/meia, ter√ßos, quartos
- **Configurador de Borda**: Bordas recheadas por metade
- **Adicionais por Metade**: Ingredientes espec√≠ficos por por√ß√£o

### **Telas Espec√≠ficas - Admin**
- **Matriz de Sabores**: Faixas de pre√ßo por tamanho
- **Regras de Composi√ß√£o**: Quantos sabores permitidos por tamanho
- **KDS Setorizado**: Montagem ‚Üí Forno ‚Üí Expedi√ß√£o
- **√Åreas de Entrega**: Configura√ß√£o por bairro/CEP

### **Campos Espec√≠ficos**
```typescript
interface PizzaProduct {
  tamanho: 'P' | 'M' | 'G' | 'XL';
  sabores: {
    id: string;
    por√ß√£o: number; // 0.5 para metade, 0.33 para ter√ßo
    pre√ßo_categoria: 'tradicional' | 'especial' | 'premium';
  }[];
  regra_pre√ßo: 'maior_valor' | 'm√©dia_ponderada';
  borda?: {
    tipo: string;
    por√ß√µes: number[]; // quais metades t√™m borda
  };
  adicionais_por_metade: {
    por√ß√£o: number;
    ingredientes: string[];
  }[];
}
```

### **Regras de Neg√≥cio**
- Pre√ßo calculado por regra_pre√ßo e quantidade de sabores
- Itens "metade" replicam adicionais por por√ß√£o espec√≠fica
- Tempo de forno calculado automaticamente por tamanho
- Entrega com faixas de pre√ßo por dist√¢ncia/bairro

### **M√≥dulos/Subm√≥dulos**
- üîÑ Compositor de Pizza
- üîÑ KDS por Setor (Montagem/Forno/Expedi√ß√£o)
- üîÑ Entrega Avan√ßada (Faixas por CEP)
- üîÑ C√°lculo de Tempo por Etapa

### **M√©tricas Principais**
- **Tempo por Etapa**: Montagem/Forno/Expedi√ß√£o
- **% Combos Pizza+Refri**: Vendas casadas
- **Sabores Mais Vendidos**: Ranking de prefer√™ncia
- **Efici√™ncia do Forno**: Pizzas/hora

---

## üëó 3. Moda & Acess√≥rios (Prioridade 3)

### **Objetivo**
Vender produtos com grade/varia√ß√µes (cor/tamanho), fotos por varia√ß√£o e estoque por SKU.

### **Telas Espec√≠ficas - Cliente**
- **Filtros Avan√ßados**: Tamanho/cor/marca/pre√ßo
- **Galeria por Varia√ß√£o**: Imagens espec√≠ficas para cada SKU
- **Tabela de Medidas**: Guia de tamanhos
- **√Årea de Trocas**: Solicita√ß√£o e acompanhamento

### **Telas Espec√≠ficas - Admin**
- **Grade de Varia√ß√µes**: Matriz cor √ó tamanho
- **Gest√£o de SKUs**: EAN, estoque por varia√ß√£o
- **Impress√£o de Etiquetas**: Integra√ß√£o com PDV
- **Controle de Trocas**: Motivos e reentrada de estoque

### **Campos Espec√≠ficos**
```typescript
interface ModaProduct {
  varia√ß√µes: {
    cor: string;
    tamanho: string;
    sku: string;
    ean?: string;
    estoque: number;
    pre√ßo?: number; // pre√ßo diferenciado por varia√ß√£o
    imagens: string[];
  }[];
  tabela_medidas: {
    tamanho: string;
    medidas: Record<string, string>; // busto, cintura, etc.
  }[];
  marca?: string;
  categoria_detalhada: string; // vestidos, camisetas, etc.
}
```

### **Regras de Neg√≥cio**
- Bloqueio autom√°tico de venda sem estoque do SKU
- Devolu√ß√£o/troca com controle de motivo e reentrada
- Pre√ßos diferenciados por varia√ß√£o (quando aplic√°vel)
- Alertas de ruptura por SKU

### **M√≥dulos/Subm√≥dulos**
- üîÑ Grade de Varia√ß√µes
- üîÑ Estoque por SKU
- üîÑ Etiquetas PDV
- üîÑ Sistema de Trocas/Devolu√ß√µes
- üîÑ Gest√£o de Marcas

### **M√©tricas Principais**
- **Giro por SKU**: Velocidade de venda por varia√ß√£o
- **Taxa de Troca**: % de devolu√ß√µes
- **% Ruptura**: Produtos sem estoque
- **Margem por Categoria**: Lucratividade

---

## üõí 4. Mercados/Supermercados (Prioridade 6)

### **Objetivo**
Vender itens fracionados (kg/l) e pes√°veis, integrar com balan√ßa e lidar com lote/validade.

### **Telas Espec√≠ficas - Cliente**
- **Produtos Fracionados**: Exibi√ß√£o de pre√ßo/kg
- **Substitui√ß√£o Sugerida**: Itens equivalentes em falta
- **Calculadora de Peso**: Para produtos pes√°veis

### **Telas Espec√≠ficas - Admin**
- **Integra√ß√£o Balan√ßa**: EAN de balan√ßa e etiquetas
- **Controle Lote/Validade**: Alertas e bloqueios
- **PDV com Leitor**: C√≥digo de barras e TEF
- **Promo√ß√µes por Mix**: Leve 3 pague 2

### **Campos Espec√≠ficos**
```typescript
interface MercadoProduct {
  uom: 'kg' | 'g' | 'l' | 'ml' | 'un';
  pre√ßo_por_unidade?: number;
  pre√ßo_por_peso?: number;
  ean_balan√ßa?: string;
  fracion√°vel: boolean;
  lotes: {
    c√≥digo: string;
    validade: Date;
    estoque: number;
  }[];
  categoria_fiscal: string;
}
```

### **Regras de Neg√≥cio**
- C√°lculo autom√°tico por peso (entrada no checkout/PDV)
- Alertas de validade pr√≥xima e bloqueio autom√°tico
- FIFO (First In, First Out) para produtos com lote
- Integra√ß√£o com balan√ßas para produtos pes√°veis

### **M√≥dulos/Subm√≥dulos**
- üîÑ Balan√ßa/ETI (Etiqueta)
- üîÑ Produtos Fracionados
- üîÑ Controle Lote/Validade
- üîÑ Sistema de Substitui√ß√£o
- üîÑ PDV com Leitor de C√≥digo

### **M√©tricas Principais**
- **% Ruptura**: Produtos em falta
- **Vencimento Iminente**: Alertas por categoria
- **Margem por Categoria**: Lucratividade
- **Giro de Estoque**: Tempo m√©dio de venda

---

## üêï 5. Petshops (Prioridade 5)

### **Objetivo**
Vender produtos e servi√ßos (banho/tosa) com agenda e ficha do pet.

### **Telas Espec√≠ficas - Cliente**
- **Ficha do Pet**: Dados, alergias, hist√≥rico
- **Agendamento de Servi√ßos**: Escolha de hor√°rio/profissional
- **Assinatura de Ra√ß√£o**: Entrega recorrente
- **Lembretes de Vacina√ß√£o**: Notifica√ß√µes autom√°ticas

### **Telas Espec√≠ficas - Admin**
- **Agenda por Profissional**: Visualiza√ß√£o por recurso/box
- **Ficha Veterin√°ria**: Hist√≥rico completo do pet
- **Comissionamento**: C√°lculo por profissional/servi√ßo
- **Gest√£o de Recursos**: Boxes, equipamentos

### **Campos Espec√≠ficos**
```typescript
interface PetshopService {
  pet: {
    nome: string;
    esp√©cie: string;
    ra√ßa: string;
    peso: number;
    alergias: string[];
    vacinas: {
      tipo: string;
      data: Date;
      pr√≥xima?: Date;
    }[];
  };
  servi√ßo: {
    tipo: string;
    dura√ß√£o: number; // minutos
    pre√ßo: number;
    profissional_id?: string;
    recurso_id?: string; // box, mesa, etc.
  };
  agenda: {
    data: Date;
    profissional: string;
    recurso: string;
    status: 'agendado' | 'em_andamento' | 'conclu√≠do';
  };
}
```

### **Regras de Neg√≥cio**
- Bloqueio de overbooking por recurso (box/equipamento)
- Pacotes de servi√ßos com m√∫ltiplos cr√©ditos
- Comiss√£o diferenciada por tipo de servi√ßo
- Lembretes autom√°ticos de vacina√ß√£o

### **M√≥dulos/Subm√≥dulos**
- üîÑ Sistema de Agenda
- üîÑ Ficha do Pet
- üîÑ Assinaturas (Recorr√™ncia)
- üîÑ Comissionamento
- üîÑ Gest√£o de Recursos

### **M√©tricas Principais**
- **Taxa de Retorno**: Clientes recorrentes
- **LTV por Tutor**: Valor vital√≠cio
- **Ocupa√ß√£o de Agenda**: % utiliza√ß√£o
- **Efetividade de Lembretes**: Taxa de agendamento

---

## üíÑ 6. Sal√µes de Beleza (Prioridade 5)

### **Objetivo**
Agendamento por profissional/cadeira, servi√ßos com dura√ß√£o e comissionamento.

### **Telas Espec√≠ficas - Cliente**
- **Self-booking**: Escolha de profissional e hor√°rio
- **Cat√°logo de Servi√ßos**: Cabelo, manicure, est√©tica
- **Pacotes de Servi√ßos**: Ex: 5 escovas com desconto
- **Hist√≥rico de Atendimentos**: Procedimentos realizados

### **Telas Espec√≠ficas - Admin**
- **Agenda Profissional**: Visualiza√ß√£o di√°ria/semanal
- **Controle de No-show**: Taxas e advert√™ncias
- **Comiss√£o por Meta**: C√°lculo autom√°tico
- **Estoque de Cosm√©ticos**: Venda + consumo interno

### **Campos Espec√≠ficos**
```typescript
interface SalaoService {
  servi√ßo: {
    categoria: 'cabelo' | 'manicure' | 'est√©tica';
    nome: string;
    dura√ß√£o: number;
    pre√ßo: number;
    comiss√£o: {
      tipo: 'fixa' | 'percentual';
      valor: number;
    };
  };
  profissional: {
    id: string;
    especialidades: string[];
    agenda: {
      disponibilidade: Record<string, string[]>; // dia: hor√°rios
      bloqueios: { inicio: Date; fim: Date; motivo: string }[];
    };
    metas: {
      per√≠odo: 'mensal' | 'semanal';
      valor_objetivo: number;
      comiss√£o_extra: number;
    };
  };
}
```

### **Regras de Neg√≥cio**
- No-show rate com taxa ou advert√™ncia autom√°tica
- Comiss√£o por servi√ßo individual + b√¥nus por meta
- Bloqueio autom√°tico de hor√°rios j√° ocupados
- Pacotes com validade e controle de cr√©ditos

### **M√≥dulos/Subm√≥dulos**
- üîÑ Sistema de Agenda Avan√ßado
- üîÑ Comissionamento por Meta
- üîÑ Pacotes de Servi√ßos
- üîÑ Estoque com Consumo Interno
- üîÑ Controle de No-show

### **M√©tricas Principais**
- **No-show Rate**: % de faltas
- **Ocupa√ß√£o por Cadeira**: Utiliza√ß√£o do espa√ßo
- **Receita por Profissional**: Performance individual
- **Taxa de Pacotes**: Vendas casadas

---

## üíä 7. Farm√°cias & Drogarias (Roadmap)

### **Objetivo**
Vender OTC e produtos regulados com valida√ß√£o de prescri√ß√£o.

### **Campos Espec√≠ficos**
```typescript
interface FarmaciaProduct {
  prescri√ß√£o: {
    obrigat√≥ria: boolean;
    arquivo?: string;
    crm_validador?: string;
    data_valida√ß√£o?: Date;
  };
  lote: string;
  validade: Date;
  regula√ß√£o: {
    anvisa: string;
    controlado: boolean;
    psicotr√≥pico: boolean;
  };
  similaridade: string[]; // produtos equivalentes
}
```

### **M√≥dulos/Subm√≥dulos**
- üîÑ Valida√ß√£o Manual de Prescri√ß√£o (MVP)
- üîÑ Controle Lote/Validade
- üîÑ PDV com Leitor especializado
- üîÑ Sistema de Rastreabilidade

---

## üè™ 8. Conveni√™ncia (Roadmap)

### **Objetivo**
Cat√°logo misto alimentos/bebidas, combos e delivery r√°pido.

### **Campos Espec√≠ficos**
```typescript
interface ConvenienciaProduct {
  janela_hor√°ria: {
    inicio: string;
    fim: string;
    dispon√≠vel: boolean;
  }[];
  combo: {
    componentes: string[];
    pre√ßo_combo: number;
    economia: number;
  };
  ocasi√£o: 'madrugada' | 'viagem' | 'trabalho';
}
```

---

## üöõ M√≥dulo Frota (Transversal Opcional)

### **Objetivo**
Cadastrar ve√≠culos, condutores e rastrear entregas pr√≥prias.

### **Campos Espec√≠ficos**
```typescript
interface Frota {
  ve√≠culo: {
    placa: string;
    renavam?: string;
    tipo: 'moto' | 'carro' | 'van';
    combust√≠vel: 'gasolina' | '√°lcool' | 'flex' | 'el√©trico';
    od√¥metro: number;
    status: 'dispon√≠vel' | 'em_rota' | 'manuten√ß√£o';
  };
  condutor: {
    nome: string;
    cnh: string;
    validade_cnh: Date;
    ve√≠culos_habilitados: string[];
  };
  manuten√ß√£o: {
    tipo: 'preventiva' | 'corretiva';
    data: Date;
    custo: number;
    pr√≥xima?: Date;
  };
}
```

### **M√©tricas**
- **Custo/km**: An√°lise de efici√™ncia
- **Disponibilidade**: % tempo ativo
- **SLA de Entrega**: Tempo m√©dio porta-a-porta

---

## üèóÔ∏è Roadmap de Implementa√ß√£o

### **Fase 1 - MVP Lanchonetes** ‚úÖ
- N√∫cleo comum completo
- Especializa√ß√£o para lanchonetes
- KDS b√°sico
- Relat√≥rios essenciais

### **Fase 2 - Pizzarias** üîÑ
- Compositor de pizza
- KDS setorizado
- Entrega por zona

### **Fase 3 - Moda & Acess√≥rios** üìã
- Grade de varia√ß√µes
- Estoque por SKU
- Sistema de trocas

### **Fase 4 - Petshops & Sal√µes** üìã
- Sistema de agenda
- Ficha de clientes/pets
- Comissionamento

### **Fase 5 - Mercados** üìã
- Produtos fracionados
- Integra√ß√£o balan√ßa
- Controle de lote

### **Fase 6 - Farm√°cias & Conveni√™ncia** üìã
- Valida√ß√£o de prescri√ß√£o
- Produtos por hor√°rio
- Regulamenta√ß√µes

### **M√≥dulo Frota** (Paralelo)
- Integra√ß√£o com qualquer segmento que tenha entrega pr√≥pria

---

## üîê Sistema de Permiss√µes

- **owner_saas**: Acesso total ao sistema
- **admin_store**: Gest√£o completa da loja
- **staff**: Opera√ß√£o di√°ria (PDV, KDS)
- **gerente_rh**: M√≥dulo RH (futuro)

Esta arquitetura garante **m√°ximo reuso** do n√∫cleo comum enquanto permite **especializa√ß√£o** profunda para cada segmento de neg√≥cio.